if: tag IS present

language: go
install: true

go:
  - 1.16.x

dist: bionic
addons:
  apt:
    source:
      - docker-bionic
    packages:
      - docker
services:
  - docker
env:
  global:
    - PROJECT: tokend
    - IMAGE_NAME: terraform-provider-tokend
script:
  - export IMAGE_TAG=$(test -z $TRAVIS_TAG && echo $TRAVIS_COMMIT || echo $TRAVIS_TAG)
  - docker build -t $PROJECT/$IMAGE_NAME:$IMAGE_TAG .
deploy:
  - provider: script
    script:
      - echo $DOCKERHUB_PASSWORD | docker login -u $DOCKERHUB_USERNAME --password-stdin
      - docker push $PROJECT/$IMAGE_NAME:$IMAGE_TAG
    on:
      all_branches: true
      tags: true
